<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation L√©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:#0B2A44;
  margin:0;
  padding:30px
}
.card{
  max-width:700px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.25)
}
h2{text-align:center;color:#0B2A44}
input,select,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px
}
button{
  background:#FDB913;
  color:#000;
  font-weight:bold;
  border:none;
  cursor:pointer
}
button:hover{opacity:.9}
.section{
  margin-top:20px;
  padding-top:10px;
  border-top:1px solid #ddd
}
.label{
  font-weight:bold;
  color:#0B2A44;
  margin-top:10px
}
#map{
  width:100%;
  height:260px;
  margin-top:12px;
  border-radius:12px;
  border:1px solid #ccc
}
.price{
  text-align:center;
  font-size:24px;
  font-weight:bold;
  color:#0B2A44;
  margin-top:20px
}
.note{
  text-align:center;
  font-size:13px;
  color:#666
}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1XwMisUcFm6UwQseU1sUU-n_55uI9AWQ"></script>
</head>

<body>

<div class="card">
<h2>üöö Estimation L√©man Courses</h2>

<div class="section">
  <div class="label">üìç Prise en charge</div>
  <input id="pc_npa" placeholder="NPA (ex: 1462)">
  <input id="pc_ville" placeholder="Ville (ex: Yvonand)">
  <input id="pc_rue" placeholder="Rue / adresse">
  <input id="pc_no" placeholder="N¬∞ de voie">
</div>

<div class="section">
  <div class="label">üöö Livraison</div>
  <input id="lv_npa" placeholder="NPA (ex: 1003)">
  <input id="lv_ville" placeholder="Ville (ex: Lausanne)">
  <input id="lv_rue" placeholder="Rue / adresse">
  <input id="lv_no" placeholder="N¬∞ de voie">
</div>

<button onclick="calculerDistance()">Calculer la distance</button>

<div id="map"></div>

<div class="section">
  <div class="label">Poids du colis (kg)</div>
  <input type="number" id="poids" value="2" min="0">

  <div class="label">Urgence</div>
  <select id="urgence">
    <option value="0">Standard</option>
    <option value="15">Express (&lt; 2h)</option>
    <option value="30">Imm√©diat (&lt; 60 min)</option>
  </select>
</div>

<div class="section">
  <label><input type="checkbox" id="nuit"> Nuit / week-end (+25 %)</label><br>
  <label><input type="checkbox" id="ue"> Passage fronti√®re UE (+40 CHF)</label>
</div>

<div class="price">
  Prix estim√© : CHF <span id="prix">25.00</span>
</div>

<div class="note">
  Prix indicatif, confirm√© apr√®s validation
</div>

<button onclick="envoyerWhatsApp()">Demander la course</button>
</div>

<script>
let map, directionsService, directionsRenderer;
let kmReels = 0;

function initMap(){
  map = new google.maps.Map(document.getElementById("map"), {
    center:{lat:46.8,lng:8.3},
    zoom:7
  });
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({map});
}

function adresse(prefix){
  const npa   = document.getElementById(prefix+"_npa").value.trim();
  const ville = document.getElementById(prefix+"_ville").value.trim();
  const rue   = document.getElementById(prefix+"_rue").value.trim();
  const no    = document.getElementById(prefix+"_no").value.trim();

  if(!/^\d{4}$/.test(npa) || !ville) return null;

  const rueNo = (rue+" "+no).trim();
  return `${rueNo}, ${npa} ${ville}, Suisse`.replace(/\s+/g," ").trim();
}

function calculerDistance(){
  const depart = adresse("pc");
  const arrivee = adresse("lv");

  if(!depart || !arrivee){
    alert("Merci de renseigner au minimum NPA (4 chiffres) et Ville.");
    return;
  }

  directionsService.route({
    origin:depart,
    destination:arrivee,
    travelMode:"DRIVING"
  },(result,status)=>{
    if(status==="OK"){
      directionsRenderer.setDirections(result);
      kmReels = result.routes[0].legs[0].distance.value / 1000;
      calculerPrix();
    }else{
      alert("Impossible de calculer l‚Äôitin√©raire");
    }
  });
}

function calculerPrix(){
  let prix = 25;
  const poids = +document.getElementById("poids").value;
  const urgence = +document.getElementById("urgence").value;
  const nuit = document.getElementById("nuit").checked;
  const ue = document.getElementById("ue").checked;

  prix += kmReels * 2.2;
  prix += urgence;
  if(poids>5 && poids<=20) prix+=10;
  if(poids>20) prix+=20;
  if(ue) prix+=40;
  if(nuit) prix*=1.25;
  if(prix<25) prix=25;

  document.getElementById("prix").innerText = prix.toFixed(2);
}

function envoyerWhatsApp(){
  const msg =
`Bonjour, je souhaite une course L√©man Courses.
Prise en charge : ${adresse("pc")}
Livraison : ${adresse("lv")}
Distance : ${kmReels.toFixed(1)} km
Prix estim√© : CHF ${prix.innerText}`;

  window.open(
    "https://wa.me/41798700488?text="+encodeURIComponent(msg),
    "_blank"
  );
}

window.onload = initMap;
</script>

</body>
</html>
