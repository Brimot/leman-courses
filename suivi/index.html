<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation ‚Äì L√©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ===== STYLE ===== -->
<style>
body{
  font-family:Arial;
  background:radial-gradient(circle at top,#123B5A,#0B2A44);
  margin:0;
  padding:30px;
}

.card{
  max-width:980px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,.3);
  border-top:6px solid #FDB913;
}

h2{text-align:center;color:#0B2A44;margin:0}
.sub{text-align:center;color:#38556e;margin-bottom:15px}

.section{
  margin-top:20px;
  padding:15px;
  border-radius:12px;
  background:#f8fbff;
}

.label{font-weight:bold;color:#0B2A44;margin-bottom:6px}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}

input:focus,select:focus{
  border-color:#FDB913;
  box-shadow:0 0 0 2px rgba(253,185,19,.25);
}

button{
  background:#FDB913;
  color:#000;
  font-weight:bold;
  border:none;
  cursor:pointer;
  margin-top:15px;
}

button:hover{transform:translateY(-2px)}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr}}

#map{
  width:100%;
  height:260px;
  margin-top:12px;
  border-radius:12px;
  border:1px solid #ccc;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#f5f7fa}

.smallbtn{
  background:#e6eef8;
  border:1px solid #cfd9e6;
  padding:6px 10px;
  border-radius:6px;
}

.badges{display:flex;gap:10px;justify-content:center;margin-top:12px}
.badge{
  background:linear-gradient(135deg,#0B2A44,#1a4b73);
  color:#fff;
  padding:8px 14px;
  border-radius:999px;
}

.pricebox{
  margin-top:20px;
  padding:15px;
  border-radius:12px;
  background:linear-gradient(135deg,#fff,#f1f6fb);
}

.pricegrid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
  text-align:center;
}

.big{font-size:22px;font-weight:bold}
.note{text-align:center;font-size:13px;color:#555;margin-top:10px}
.warn{color:#b00020;font-weight:bold;text-align:center}
</style>

<!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=TA_CLE_ICI&callback=initMap" async defer></script>
</head>

<body>

<form id="formDemande" method="POST" target="_blank">

<div class="card">
<h2>üöö Estimation L√©man Courses</h2>
<p class="sub">Calcul r√©el Google Maps ¬∑ TVA 8.1 % ¬∑ Minimum 25 CHF</p>

<div class="section">
<div class="label">üë§ Client</div>
<div class="grid-3">
<input id="client_nom" placeholder="Nom / Entreprise" required>
<input id="client_tel" placeholder="T√©l√©phone">
<input id="client_email" placeholder="E-mail" required>
</div>
</div>

<div class="section">
<div class="label">üìç Prise en charge</div>
<div class="grid-2">
<input id="pc_npa" placeholder="NPA">
<input id="pc_ville" placeholder="Ville">
<input id="pc_rue" placeholder="Rue">
<input id="pc_no" placeholder="N¬∞">
</div>
</div>

<div class="section">
<div class="label">üöö Livraison</div>
<div class="grid-2">
<input id="lv_npa" placeholder="NPA">
<input id="lv_ville" placeholder="Ville">
<input id="lv_rue" placeholder="Rue">
<input id="lv_no" placeholder="N¬∞">
</div>
</div>

<button type="button" onclick="calculerDistance()">Calculer la distance</button>
<div id="map"></div>

<div class="badges">
<div class="badge">Distance: <strong><span id="distance_txt">‚Äì</span> km</strong></div>
<div class="badge">Dur√©e: <strong><span id="duree_txt">‚Äì</span> min</strong></div>
</div>

<div class="section">
<div class="label">üì¶ Colis</div>
<table>
<thead><tr><th>#</th><th>Poids</th><th>Dimensions</th><th>Action</th></tr></thead>
<tbody id="colis_table"></tbody>
</table>
<button class="smallbtn" type="button" onclick="ajouterColis()">+ Ajouter un colis</button>
</div>

<div class="pricebox">
<div class="label">üí∞ Prix</div>
<div class="pricegrid">
<div>HT<br><span class="big">CHF <span id="prix_ht">‚Äì</span></span></div>
<div>TVA<br><span class="big">CHF <span id="prix_tva">‚Äì</span></span></div>
<div>TTC<br><span class="big">CHF <span id="prix_ttc">‚Äì</span></span></div>
</div>
<div id="warn" class="warn"></div>
</div>

<div class="note">Prix indicatif ‚Äì confirm√© apr√®s validation</div>
</div>
</form>

<!-- ===== SCRIPT ===== -->
<script>
const TVA = 0.081;
const PRIX_KM = 1.20;
let km=0,duree=0;
let map,ds,dr;
let colis=[];

function initMap(){
 map=new google.maps.Map(document.getElementById("map"),{center:{lat:46.8,lng:8.3},zoom:7});
 ds=new google.maps.DirectionsService();
 dr=new google.maps.DirectionsRenderer({map});
}

function adresse(p){
 return `${document.getElementById(p+"_rue").value} ${document.getElementById(p+"_no").value}, ${document.getElementById(p+"_npa").value} ${document.getElementById(p+"_ville").value}, Suisse`;
}

function calculerDistance(){
 ds.route({origin:adresse("pc"),destination:adresse("lv"),travelMode:"DRIVING"},(r,s)=>{
  if(s==="OK"){
   dr.setDirections(r);
   const leg=r.routes[0].legs[0];
   km=leg.distance.value/1000;
   duree=Math.ceil(leg.duration.value/60);
   distance_txt.innerText=km.toFixed(1);
   duree_txt.innerText=duree;
   recalculer();
  }
 });
}

function ajouterColis(){
 colis.push({id:Date.now(),poids:1});
 renderColis(); recalculer();
}

function supprimerColis(id){
 colis=colis.filter(c=>c.id!==id);
 renderColis(); recalculer();
}

function renderColis(){
 colis_table.innerHTML="";
 colis.forEach((c,i)=>{
  colis_table.innerHTML+=`
  <tr>
   <td>${i+1}</td>
   <td><input type="number" value="${c.poids}" oninput="c=colis[${i}];c.poids=this.value;recalculer()"></td>
   <td>Standard</td>
   <td>${i==0?"‚Äî":`<button onclick="supprimerColis(${c.id})">‚ùå</button>`}</td>
  </tr>`;
 });
}

function recalculer(){
 let ht=Math.max(25,km*PRIX_KM);
 let tva=ht*TVA;
 let ttc=ht+tva;
 prix_ht.innerText=ht.toFixed(2);
 prix_tva.innerText=tva.toFixed(2);
 prix_ttc.innerText=ttc.toFixed(2);
}

ajouterColis();
</script>

</body>
</html>
