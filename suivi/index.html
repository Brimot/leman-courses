<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation Léman Courses</title>
</head>

<body>

<h2>Estimation Léman Courses</h2>

Départ :  
<input id="pc_npa" placeholder="NPA">
<input id="pc_ville" placeholder="Ville">

<br><br>

Arrivée :  
<input id="lv_npa" placeholder="NPA">
<input id="lv_ville" placeholder="Ville">

<br><br>

<button onclick="calculer()">Calculer distance</button>

<p>
Distance : <span id="km">–</span> km  
Durée : <span id="duree">–</span> min
</p>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwY2YskKV_DXT2cxl9Wb2h-jRdCGwfa4oo6rCuea2TmjeJEmpGNCz77VXCDlX5nZMlp/exec";

function adresse(p){
  const npa = document.getElementById(p+"_npa").value.trim();
  const ville = document.getElementById(p+"_ville").value.trim();

  if(!npa || !ville){
    alert("NPA et Ville obligatoires");
    return "";
  }

  return npa + " " + ville + ", Suisse";
}

function calculer(){
  const from = adresse("pc");
  const to = adresse("lv");
  if(!from || !to) return;

  fetch(SCRIPT_URL + "?action=distance&from=" +
        encodeURIComponent(from) +
        "&to=" +
        encodeURIComponent(to))
  .then(r => r.json())
  .then(res => {
    console.log(res);
    if(res.error){
      alert(res.error);
      return;
    }
    km.innerText = res.km;
    duree.innerText = res.duree;
  });
}
</script>

</body>
</html>
