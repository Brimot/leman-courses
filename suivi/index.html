<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{font-family:Arial;background:#0B2A44;padding:30px}
.card{max-width:600px;margin:auto;background:#fff;padding:25px;border-radius:14px}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid #ccc}
button{background:#FDB913;border:none;font-weight:bold}
#map{height:300px;margin-top:20px;border-radius:10px}
</style>
</head>

<body>
<div class="card">
<h2>ðŸ“¦ Suivi LÃ©man Courses</h2>
<input id="code" placeholder="LC-001">
<button onclick="go()">Suivre</button>
<div id="res"></div>
<div id="map"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyj8dN3F_huMqbA2latlCcSnRDvt--6QLkcjg5IVFiaY19_A95oenPOUEeQhl-jqIWZ/exec";

async function go(){
  const code = document.getElementById("code").value;
  const res = document.getElementById("res");

  const r = await fetch(API+"?code="+encodeURIComponent(code));
  const d = await r.json();

  if(d.error){res.innerHTML=d.error;return;}

  res.innerHTML = `
  <b>${d.statut}</b><br>
  ${d.prise.ville} â†’ ${d.livraison.ville}<br>
  ${d.client.nom}
  `;

  const a=[d.prise.lat,d.prise.lng];
  const b=[d.livraison.lat,d.livraison.lng];

  const map=L.map("map").setView(a,10);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  L.marker(a).addTo(map).bindPopup("Prise");
  L.marker(b).addTo(map).bindPopup("Livraison");
  L.polyline([a,b],{color:"red"}).addTo(map);
}
</script>
</body>
</html>
