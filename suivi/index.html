<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation ‚Äì L√©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#0B2A44,#123B5A);
  margin:0;
  padding:30px;
}
.card{
  max-width:980px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,.3);
}
h2{text-align:center;color:#0B2A44;margin:0}
.sub{text-align:center;color:#38556e;margin-top:4px}
input,select,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#FDB913;
  font-weight:bold;
  border:none;
  cursor:pointer;
}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
@media(max-width:820px){.grid-2,.grid-3{grid-template-columns:1fr}}
#map{width:100%;height:280px;margin-top:12px;border-radius:12px;border:1px solid #ddd}
.badge{background:#0B2A44;color:#fff;padding:8px 14px;border-radius:999px}
.badges{display:flex;justify-content:center;gap:10px;margin-top:12px}
.pricegrid{display:grid;grid-template-columns:1fr 1fr 1fr;text-align:center}
.big{font-size:22px;font-weight:bold}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1XwMisUcFm6UwQseU1sUU-n_55uI9AWQ&callback=initMap" async defer></script>
</head>

<body>

<form action="https://script.google.com/macros/s/AKfycbxyrSTQETLmwE94AQWwQ3HZ82dOOssy4a72CxBIFS9pdSjWFOMapogQG2j61FPHkdn1/exec"
      method="POST" target="_blank">

<div class="card">

<h2>üöö Estimation L√©man Courses</h2>
<p class="sub">Calcul automatique Google Maps</p>

<div class="grid-3">
<input name="client" placeholder="Nom" required>
<input name="tel" placeholder="T√©l√©phone">
<input name="email" placeholder="E-mail" required>
</div>

<h3>üìç Prise en charge</h3>
<div class="grid-2">
<input id="pc_npa" placeholder="NPA" oninput="autoVilleGoogle(this.value,'pc_ville')">
<input id="pc_ville" placeholder="Ville">
<input id="pc_rue" placeholder="Rue">
<input id="pc_no" placeholder="N¬∞">
</div>

<h3>üöö Livraison</h3>
<div class="grid-2">
<input id="lv_npa" placeholder="NPA" oninput="autoVilleGoogle(this.value,'lv_ville')">
<input id="lv_ville" placeholder="Ville">
<input id="lv_rue" placeholder="Rue">
<input id="lv_no" placeholder="N¬∞">
</div>

<button type="button" onclick="calculerDistance()">Calculer distance</button>
<div id="map"></div>

<div class="badges">
<div class="badge">Distance: <span id="distance_txt">‚Äì</span> km</div>
<div class="badge">Dur√©e: <span id="duree_txt">‚Äì</span> min</div>
</div>

<select id="service" onchange="recalculer()">
<option value="">Type de livraison</option>
<option value="urgent">Urgente</option>
<option value="express">Express</option>
<option value="eco">Eco</option>
</select>

<div class="pricegrid">
<div>HT<br><span class="big">CHF <span id="prix_ht">‚Äì</span></span></div>
<div>TVA<br><span class="big">CHF <span id="prix_tva">‚Äì</span></span></div>
<div>TTC<br><span class="big">CHF <span id="prix_ttc">‚Äì</span></span></div>
</div>

<button type="submit" onclick="return avantEnvoi()">Envoyer</button>

</div>
</form>

<script>
let map, ds, dr, km=0, duree=0;
let colis=[];

function adresse(p){
  const rue = document.getElementById(p+"_rue").value.trim();
  const no = document.getElementById(p+"_no").value.trim();
  const npa = document.getElementById(p+"_npa").value.trim();
  const ville = document.getElementById(p+"_ville").value.trim();
  return `${rue} ${no}, ${npa} ${ville}, Suisse`.replace(/\s+/g," ").trim();
}

function ajouterColis(){
  colis.push({id:Date.now(), poids:1});
  renderColis();
  recalculer();
}

function renderColis(){
  colis_table.innerHTML="";
  colis.forEach((c,i)=>{
    colis_table.innerHTML += `
<tr>
<td>${i+1}</td>
<td><input type="number" value="${c.poids}" oninput="majColis(${c.id}, this.value)"></td>
<td>30√ó20√ó10</td>
<td>Standard</td>
<td>${i?'<button onclick="supprimerColis('+c.id+')">‚ùå</button>':'‚Äî'}</td>
</tr>`;
  });
}

function majColis(id,val){
  const c = colis.find(x=>x.id===id);
  if(c){ c.poids = Number(val)||0; recalculer(); }
}

function supprimerColis(id){
  colis = colis.filter(c=>c.id!==id);
  renderColis();
  recalculer();
}

function recalculer(){
  if(!km) return;

  let ht = Math.max(25, km*1.2);
  let tva = ht*0.081;
  let ttc = ht+tva;

  prix_ht.innerText = ht.toFixed(2);
  prix_tva.innerText = tva.toFixed(2);
  prix_ttc.innerText = ttc.toFixed(2);
}


function avantEnvoi(){
  if(!km){ alert("Calcule la distance"); return false; }
  return true;
}
</script>

</body>
</html>
