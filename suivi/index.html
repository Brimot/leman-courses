<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation â€“ LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#0B2A44;margin:0;padding:30px}
.card{max-width:900px;margin:auto;background:#fff;padding:25px;border-radius:18px}
input,select,button{width:100%;padding:12px;margin-top:8px;border-radius:8px}
button{background:#FDB913;font-weight:bold;border:none}
#map{height:280px;margin-top:12px}
.badges{display:flex;gap:10px;justify-content:center}
.badge{background:#0B2A44;color:white;padding:8px 12px;border-radius:20px}
.price{font-size:20px;text-align:center}
</style>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1XwMisUcFm6UwQseU1sUU-n_55uI9AWQ" async defer></script>


</head>

<body>

<form id="formDemande" onsubmit="return envoyerFormulaire()">
<div class="card">
  <div style="text-align:center;margin-bottom:15px">
  <img src="logo.png" height="48">
</div>


<h2>ðŸšš Estimation LÃ©man-Courses</h2>

<input name="client" placeholder="Nom" required>
<input name="tel" placeholder="TÃ©lÃ©phone">
<input name="email" placeholder="Email" required>

<h3>DÃ©part</h3>
<input id="pc_npa" placeholder="NPA">
<input id="pc_ville" placeholder="Ville">

<h3>ArrivÃ©e</h3>
<input id="lv_npa" placeholder="NPA">
<input id="lv_ville" placeholder="Ville">

<button type="button" onclick="calculerDistance()">Calculer distance</button>
<div id="map"></div>

<div class="badges">
  <div class="badge">KM: <span id="distance_txt">â€“</span></div>
  <div class="badge">Min: <span id="duree_txt">â€“</span></div>
</div>

<select id="service" onchange="recalculer()">
  <option value="">Service</option>
  <option value="eco">Eco 48h</option>
  <option value="express">Express 12h</option>
  <option value="urgent">Urgent 4h</option>
</select>

<h3>Colis</h3>
<table><tbody id="colis_table"></tbody></table>
<button type="button" onclick="ajouterColis()">+ Ajouter colis</button>

<div class="price">
HT: <span id="prix_ht">â€“</span> CHF<br>
TVA: <span id="prix_tva">â€“</span> CHF<br>
<b>TTC: <span id="prix_ttc">â€“</span> CHF</b>
</div>

<input type="hidden" name="depart" id="f_depart">
<input type="hidden" name="arrivee" id="f_arrivee">
<input type="hidden" name="km" id="f_km">
<input type="hidden" name="duree" id="f_duree">
<input type="hidden" name="prix_ht" id="f_prix_ht">
<input type="hidden" name="prix_tva" id="f_prix_tva">
<input type="hidden" name="prix_ttc" id="f_prix_ttc">
<input type="hidden" name="colis_json" id="f_colis_json">

<button type="submit">Envoyer</button>
</div>
</form>

<div id="popup" style="https://script.google.com/macros/s/AKfycbz2DGzuMEtCwzqQYuwUeA8xsdGaiedNAA8FtjDbS47fmn36UvkfKKOjrRuWnJMSN7Nu/exec">
âœ… Demande envoyÃ©e
</div>

<script>
let map, ds, dr, km=0, duree=0;
let colis=[];

const TVA=0.081;
const PRIX_BASE={eco:25,express:35,urgent:45};
const MULTI_KM={eco:1,express:1.2,urgent:1.4};

function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{center:{lat:46.8,lng:8.3},zoom:7});
  ds=new google.maps.DirectionsService();
  dr=new google.maps.DirectionsRenderer({map});
}

function adresse(p){
  return document.getElementById(p+"_npa").value+" "+document.getElementById(p+"_ville").value;
}

function calculerDistance(){
  ds.route({origin:adresse("pc"),destination:adresse("lv"),travelMode:"DRIVING"},(r,s)=>{
    if(s==="OK"){
      dr.setDirections(r);
      km=r.routes[0].legs[0].distance.value/1000;
      duree=Math.ceil(r.routes[0].legs[0].duration.value/60);
      distance_txt.innerText=km.toFixed(1);
      duree_txt.innerText=duree;
      recalculer();
    }
  });
}

function ajouterColis(){
  colis.push({id:Date.now(),poids:1});
  renderColis();
}

function renderColis(){
  colis_table.innerHTML="";
  colis.forEach((c,i)=>{
    colis_table.innerHTML+=`
<tr>
<td>${i+1}</td>
<td><input type="number" value="${c.poids}" oninput="c.poids=this.value;recalculer()"></td>
</tr>`;
  });
}

function recalculer(){
  if(!km||!service.value) return;
  let ht=PRIX_BASE[service.value]+km*MULTI_KM[service.value]+(colis.length-1)*5;
  let tva=ht*TVA;
  prix_ht.innerText=ht.toFixed(2);
  prix_tva.innerText=tva.toFixed(2);
  prix_ttc.innerText=(ht+tva).toFixed(2);
}

function envoyerFormulaire(){
  f_depart.value=adresse("pc");
  f_arrivee.value=adresse("lv");
  f_km.value=km;
  f_duree.value=duree;
  f_prix_ht.value=prix_ht.innerText;
  f_prix_tva.value=prix_tva.innerText;
  f_prix_ttc.value=prix_ttc.innerText;
  f_colis_json.value=JSON.stringify(colis);

  fetch("URL_DE_TON_SCRIPT_GOOGLE",{method:"POST",body:new FormData(formDemande)});

  popup.style.display="block";
  formDemande.reset();
  colis=[]; ajouterColis();
  setTimeout(()=>popup.style.display="none",5000);
  return false;
}

ajouterColis();
</script>
</body>
</html>
