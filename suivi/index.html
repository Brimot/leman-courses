<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Estimation LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#0B2A44;margin:0;padding:30px}
.card{max-width:700px;margin:auto;background:#fff;padding:25px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
h2{text-align:center;color:#0B2A44}
input,select,button{width:100%;padding:14px;margin-top:10px;border-radius:10px;border:1px solid #ccc;font-size:16px}
button{background:#FDB913;color:#000;font-weight:bold;border:none;cursor:pointer}
button:hover{opacity:.9}
.section{margin-top:20px;padding-top:10px;border-top:1px solid #ddd}
.label{font-weight:bold;color:#0B2A44;margin-top:10px}
#map{width:100%;height:260px;margin-top:12px;border-radius:12px;border:1px solid #ccc}
.price{text-align:center;font-size:22px;font-weight:bold;color:#0B2A44;margin-top:20px}
.note{text-align:center;font-size:13px;color:#666}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:700px){.grid-2{grid-template-columns:1fr}}

.badge{
  background:#f5f7fa;
  border:1px solid #ccc;
  border-radius:12px;
  padding:12px;
  text-align:center;
  font-size:14px;
  color:#0B2A44
}
.badge strong{display:block;margin-top:6px;font-size:17px}
.badge span{display:block;font-size:13px;color:#555}
.badge.active{
  border:2px solid #FDB913;
  background:#fffbe6
}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1XwMisUcFm6UwQseU1sUU-n_55uI9AWQ"></script>
</head>

<body>

<div class="card">
<h2>ğŸšš Estimation LÃ©man Courses</h2>

<div class="section">
  <div class="label">ğŸ‘¤ CoordonnÃ©es client</div>
  <input id="client_nom" placeholder="Nom / Entreprise">
  <input id="client_tel" placeholder="TÃ©lÃ©phone">
  <input id="client_email" placeholder="E-mail">
</div>

<div class="section">
  <div class="label">ğŸ•’ Heure souhaitÃ©e</div>
  <input type="datetime-local" id="heure_souhaitee">
</div>

<div class="section">
  <div class="label">ğŸ“ Prise en charge</div>
  <div class="grid-2">
    <input id="pc_npa" placeholder="NPA">
    <input id="pc_ville" placeholder="Ville">
    <input id="pc_rue" placeholder="Rue">
    <input id="pc_no" placeholder="NÂ°">
  </div>
</div>

<div class="section">
  <div class="label">ğŸšš Livraison</div>
  <div class="grid-2">
    <input id="lv_npa" placeholder="NPA">
    <input id="lv_ville" placeholder="Ville">
    <input id="lv_rue" placeholder="Rue">
    <input id="lv_no" placeholder="NÂ°">
  </div>
</div>

<button onclick="calculerDistance()">Calculer la distance</button>
<div id="map"></div>

<div class="section">
  <div class="label">ğŸš€ Type de livraison</div>
  <select id="service" onchange="choisirService()">
    <option value="">â€” Choisir â€”</option>
    <option value="urgent">Urgente â€“ 4h</option>
    <option value="express">Express â€“ 12h</option>
    <option value="priority">Priority â€“ 24h</option>
    <option value="eco">Eco â€“ 48h</option>
  </select>
</div>

<div class="section">
  <div class="label">ğŸ’° Estimation par service</div>
  <div class="grid-2">
    <div class="badge" id="b_urgent">Urgente 4h
      <strong>â€”</strong>
      <span id="d_urgent">â€”</span>
    </div>
    <div class="badge" id="b_express">Express 12h
      <strong>â€”</strong>
      <span id="d_express">â€”</span>
    </div>
    <div class="badge" id="b_priority">Priority 24h
      <strong>â€”</strong>
      <span id="d_priority">â€”</span>
    </div>
    <div class="badge" id="b_eco">Eco 48h
      <strong>â€”</strong>
      <span id="d_eco">â€”</span>
    </div>
  </div>
</div>

<div class="price">
  Distance : <span id="distance_txt">â€“</span> km<br>
  DurÃ©e rÃ©elle : <span id="duree_reelle">â€“</span><br><br>
  Prix estimÃ© : CHF <span id="prix">25.00</span>
</div>

<div class="note">Prix et dÃ©lais indicatifs</div>

<button onclick="envoyerServeur()">Envoyer la demande</button>
</div>

<script>
let map, directionsService, directionsRenderer;
let kmReels = 0;
let dureeReelleMin = 0;

function initMap(){
  map = new google.maps.Map(document.getElementById("map"), {
    center:{lat:46.8,lng:8.3}, zoom:7
  });
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({map});
}

function adresse(p){
  const npa=document.getElementById(p+"_npa").value.trim();
  const ville=document.getElementById(p+"_ville").value.trim();
  const rue=document.getElementById(p+"_rue").value.trim();
  const no=document.getElementById(p+"_no").value.trim();
  if(!/^\d{4}$/.test(npa)||!ville) return null;
  return `${rue} ${no}, ${npa} ${ville}, Suisse`.replace(/\s+/g," ").trim();
}

function calculerDistance(){
  const d=adresse("pc"), a=adresse("lv");
  if(!d||!a){alert("NPA + Ville requis");return;}

  directionsService.route({origin:d,destination:a,travelMode:"DRIVING"},(r,s)=>{
    if(s==="OK"){
      directionsRenderer.setDirections(r);
      const leg=r.routes[0].legs[0];
      kmReels=leg.distance.value/1000;
      dureeReelleMin=Math.max(15,Math.ceil(leg.duration.value/60));

      distance_txt.innerText=kmReels.toFixed(1);
      duree_reelle.innerText=dureeReelleMin+" min";

      majBadges();
    }
  });
}

function prixService(type){
  if(kmReels <= 0) return 0;

  // Prix de base pour 65 km / 0-15 kg
  const base = {
    urgent:   65,
    express:  50,
    priority: 35,
    eco:      27
  };

  let prix = base[type] || 0;
  const poids = parseFloat(document.getElementById("poids").value) || 0;

  // SupplÃ©ment poids
  if(poids > 15 && poids <= 25){
    prix += (poids - 15) * 2;
  }

  if(poids > 25){
    prix += (10 * 2); // 15â†’25 kg
    prix += (poids - 25) * 5;
  }

  return prix;
}


function majBadges(){
  ["urgent","express","priority","eco"].forEach(t=>{
    document.querySelector("#b_"+t+" strong").innerText =
      "CHF "+prixService(t).toFixed(2);
    document.getElementById("d_"+t).innerText =
      "DÃ©lai : "+dureeService(t);
  });
}

function choisirService(){
  const s=service.value;
  if(!s)return;

  document.querySelectorAll(".badge").forEach(b=>b.classList.remove("active"));
  document.getElementById("b_"+s).classList.add("active");

  prix.innerText=prixService(s).toFixed(2);
}

function envoyerServeur(){
  fetch("https://script.google.com/macros/s/AKfycbyn7re1v9UPX59oxKqLWIC3-chmuZHsc38E72g9AfQ17R2jsjtGAMX_fjg3wurtAp5H/exec",{
    method:"POST",
    body:JSON.stringify({
      nom:client_nom.value,
      tel:client_tel.value,
      email:client_email.value,
      heure:heure_souhaitee.value,
      depart:adresse("pc"),
      arrivee:adresse("lv"),
      distance:kmReels,
      duree:dureeReelleMin,
      service:service.value,
      prix:prix.innerText
    }),
    headers:{"Content-Type":"application/json"}
  }).then(()=>alert("Demande envoyÃ©e"));
}

window.onload=initMap;
</script>

</body>
</html>
