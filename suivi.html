<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi â€“ LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#0B2A44;margin:0;padding:30px}
.card{max-width:700px;margin:auto;background:#fff;padding:25px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
h2{text-align:center;color:#0B2A44}
input,button{width:100%;padding:14px;margin-top:10px;border-radius:10px;border:1px solid #ccc;font-size:16px}
button{background:#FDB913;color:#000;font-weight:bold;border:none;cursor:pointer}
.section{margin-top:20px;padding-top:10px;border-top:1px solid #ddd}
.label{font-weight:bold;color:#0B2A44}
#error{color:#b00020;font-weight:bold;text-align:center;margin-top:15px}
</style>
</head>

<body>

<div class="card">
  <h2>ðŸ“¦ Suivi LÃ©man-Courses</h2>

  <input id="code" placeholder="Ex : LC-2026-xxxxxx">
  <button onclick="suivre()">Suivre mon envoi</button>

  <div id="error"></div>

  <div id="resultat" style="display:none">
    <div class="section">
      <div class="label">Statut</div>
      <div id="statut"></div>
      <div id="etape"></div>
    </div>

    <div class="section">
      <div class="label">Trajet</div>
      <div id="trajet"></div>
      <div id="distance"></div>
    </div>

    <div class="section">
      <div class="label">DerniÃ¨re mise Ã  jour</div>
      <div id="updated"></div>
    </div>
  </div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const API_URL = "const API_URL = "https://script.google.com/macros/s/AKfycbyd0bruIwHFeQkRlh9eOP_w9ch7F3UXmuFLY6VLEwpRQDflvcDabYNR7tDYCqgCd2c/exec";
";

/* =========================
   UTILS
========================= */
function qs(name){
  return new URLSearchParams(window.location.search).get(name);
}

function showError(msg){
  document.getElementById("error").textContent = msg;
  document.getElementById("result").style.display = "none";
}

function showResult(){
  document.getElementById("error").textContent = "";
  document.getElementById("result").style.display = "block";
}

/* =========================
   AUTO-REMPLISSAGE VIA URL
   ex: suivi.html?id=LC-2026-000123
========================= */
window.addEventListener("DOMContentLoaded", () => {
  const id = qs("id");
  if (id) {
    document.getElementById("code").value = id;
    rechercher();
  }
});

/* =========================
   FETCH SUIVI
========================= */
async function rechercher(){
  const code = document.getElementById("code").value.trim();
  if(!code){
    showError("Veuillez entrer un numÃ©ro de suivi.");
    return;
  }

  try {
    const res = await fetch(API_URL + "?id=" + encodeURIComponent(code));
    const data = await res.json();

    if (data.error){
      showError(data.error);
      return;
    }

    // Remplissage
    document.getElementById("f_id").textContent = data.id || "â€”";
    document.getElementById("f_client").textContent = data.client || "â€”";
    document.getElementById("f_service").textContent = data.service || "â€”";
    document.getElementById("f_depart").textContent = data.depart || "â€”";
    document.getElementById("f_arrivee").textContent = data.arrivee || "â€”";
    document.getElementById("f_km").textContent = data.km ? data.km + " km" : "â€”";
    document.getElementById("f_duree").textContent = data.duree ? data.duree + " min" : "â€”";
    document.getElementById("f_statut").textContent = data.statut || "â€”";
    document.getElementById("f_etape").textContent = data.etape || "â€”";
    document.getElementById("f_update").textContent = data.updated || "â€”";

    showResult();

  } catch (err) {
    showError("Erreur de connexion au service de suivi.");
  }
}
</script>
