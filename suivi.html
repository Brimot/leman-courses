<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi â€“ LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#0B2A44;margin:0;padding:30px}
.card{max-width:700px;margin:auto;background:#fff;padding:25px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
h2{text-align:center;color:#0B2A44}
input,button{width:100%;padding:14px;margin-top:10px;border-radius:10px;border:1px solid #ccc;font-size:16px}
button{background:#FDB913;color:#000;font-weight:bold;border:none}
.section{margin-top:18px;padding-top:10px;border-top:1px solid #ddd}
.label{font-weight:bold;color:#0B2A44}
#error{color:red;text-align:center;font-weight:bold}
.value{margin:5px 0}

/* Timeline */
.timeline-item{display:flex;gap:10px;margin:10px 0}
.dot{width:12px;height:12px;background:#0B2A44;border-radius:50%;margin-top:4px}
.dot.last{background:#2e7d32}
.line{width:2px;background:#ccc;margin-left:5px}
</style>
</head>

<body>

<div class="card">
<h2>ðŸ“¦ Suivi LÃ©man-Courses</h2>

<input id="code" placeholder="LC-2026-000123">
<button onclick="rechercher()">Suivre</button>

<div id="error"></div>

<div id="result" style="display:none">

<div class="section"><div class="label">Client</div><div id="f_client"></div></div>
<div class="section"><div class="label">Service</div><div id="f_service"></div></div>
<div class="section"><div class="label">Trajet</div><div><span id="f_depart"></span> â†’ <span id="f_arrivee"></span></div></div>
<div class="section"><div class="label">Distance / DurÃ©e</div><div><span id="f_km"></span> Â· <span id="f_duree"></span></div></div>
<div class="section"><div class="label">Statut</div><div id="f_statut"></div></div>
<div class="section"><div class="label">DerniÃ¨re mise Ã  jour</div><div id="f_update"></div></div>
<div class="section"><div class="label">Prix</div><div id="f_prix"></div></div>

<div class="section">
  <div class="label">Historique</div>
  <div id="timeline"></div>
</div>

</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxyrSTQETLmwE94AQWwQ3HZ82dOOssy4a72CxBIFS9pdSjWFOMapogQG2j61FPHkdn1/exec";

function rechercher(){
  error.textContent="";
  const code = document.getElementById("code").value.trim();
  if(!code){ error.textContent="Code manquant"; return; }

  fetch(API_URL + "?id=" + encodeURIComponent(code))
    .then(r=>r.json())
    .then(d=>{
      if(d.error){ error.textContent=d.error; return; }

      f_client.textContent = d.client;
      f_service.textContent = d.service;
      f_depart.textContent = d.depart;
      f_arrivee.textContent = d.arrivee;
      f_km.textContent = d.km + " km";
      f_duree.textContent = d.duree;
      f_statut.textContent = d.statut;
      f_update.textContent = d.updated;
      f_prix.textContent = "CHF " + d.prixTTC;

      // Timeline
      timeline.innerHTML="";
      d.history.forEach((h,i)=>{
        const last = i === d.history.length-1;
        timeline.innerHTML += `
          <div class="timeline-item">
            <div>
              <div class="dot ${last?"last":""}"></div>
              ${last?"":"<div class='line' style='height:30px'></div>"}
            </div>
            <div>
              <strong>${h.statut}</strong><br>
              ${h.date}<br>
              <small>${h.comment||""}</small>
            </div>
          </div>
        `;
      });

      result.style.display="block";
    })
    .catch(()=> error.textContent="Erreur connexion API");
}
</script>

</body>
</html>
