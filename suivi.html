<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi â€“ LÃ©man Courses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, sans-serif;
  background: linear-gradient(135deg,#0B2A44,#5B6CFF);
  min-height:100vh;
  color:#111;
}

.app{
  max-width:600px;
  margin:40px auto;
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
}

.header{
  text-align:center;
  color:#fff;
  margin-bottom:20px;
}
.logo{
  font-size:28px;
  font-weight:800;
}
.slogan{
  font-size:14px;
  opacity:.9;
}

.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-top:12px;
  box-shadow:0 6px 12px rgba(0,0,0,.08);
}

.badge{
  display:inline-block;
  padding:8px 14px;
  border-radius:999px;
  font-weight:700;
  color:#fff;
  margin-bottom:10px;
}
.badge.attente{ background:#777; }
.badge.prise{ background:#3b82f6; }
.badge.livraison{ background:#f59e0b; }
.badge.livre{ background:#22c55e; }

.row{
  margin:6px 0;
  font-size:15px;
}

.timeline{
  margin-top:10px;
}
.step{
  display:flex;
  align-items:center;
}
.dot{
  width:14px;
  height:14px;
  border-radius:50%;
  background:#ccc;
  margin-right:10px;
}
.dot.active{ background:#22c55e; }
.line{
  width:2px;
  height:20px;
  background:#ccc;
  margin:0 0 0 6px;
}
.error{
  color:#c62828;
  text-align:center;
  font-weight:700;
}
</style>
</head>

<body>

<div class="header">
  <div class="logo">ðŸšš LÃ©man-Courses</div>
  <div class="slogan">Transport express â€“ Suisse romande</div>
</div>

<div class="app">

  <input id="code" placeholder="NumÃ©ro de suivi" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ccc">
  <button onclick="loadSuivi()" style="margin-top:10px;width:100%;padding:12px;border-radius:10px;background:#5B6CFF;color:#fff;border:none;font-weight:700">
    Suivre mon colis
  </button>

  <div id="error" class="error"></div>

  <div id="result" style="display:none">

    <div class="card">
      <div id="badge" class="badge"></div>
      <div class="row"><strong>Client :</strong> <span id="f_client"></span></div>
      <div class="row"><strong>Trajet :</strong> <span id="f_depart"></span> â†’ <span id="f_arrivee"></span></div>
      <div class="row"><strong>Distance :</strong> <span id="f_km"></span></div>
      <div class="row"><strong>DurÃ©e :</strong> <span id="f_duree"></span></div>
      <div class="row"><strong>DerniÃ¨re mise Ã  jour :</strong> <span id="f_update"></span></div>
    </div>

    <div class="card">
      <strong>Historique</strong>
      <div id="timeline" class="timeline"></div>
    </div>

  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxyrSTQETLmwE94AQWwQ3HZ82dOOssy4a72CxBIFS9pdSjWFOMapogQG2j61FPHkdn1/exec";

function loadSuivi(){
  const id = document.getElementById("code").value.trim();
  if(!id) return;

  fetch(API_URL + "?id=" + encodeURIComponent(id))
    .then(r => r.json())
    .then(d => {
      if(d.error){
        document.getElementById("error").textContent = d.error;
        return;
      }

      document.getElementById("result").style.display="block";
      document.getElementById("error").textContent="";

      f_client.textContent = d.client;
      f_depart.textContent = d.depart;
      f_arrivee.textContent = d.arrivee;
      f_km.textContent = d.km + " km";
      f_duree.textContent = d.duree;
      f_update.textContent = d.date;

      // badge
      const b = document.getElementById("badge");
      b.textContent = d.statut;
      b.className = "badge " + (
        d.statut=="LivrÃ©" ? "livre" :
        d.statut=="En livraison" ? "livraison" :
        d.statut=="Pris en charge" ? "prise" : "attente"
      );

      // timeline
      timeline.innerHTML="";
      d.history.forEach(h=>{
        timeline.innerHTML += `
          <div class="step">
            <div class="dot active"></div>
            <div>${h.date} â€“ ${h.statut} ${h.comment||""}</div>
          </div>
          <div class="line"></div>
        `;
      });
    })
    .catch(()=>{
      document.getElementById("error").textContent="Erreur de connexion";
    });
}
</script>
</body>
</html>
